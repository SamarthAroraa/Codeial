class ToggleLikes{constructor(e){this.toggler=e,this.toggleLike()}toggleLike(){$(this.toggler).click((function(e){e.preventDefault();let t=this;$.ajax({type:"GET",url:$(t).attr("href")}).done((function(e){let n=parseInt($(t).attr("like-count"));e.data.deleted?n-=1:n+=1,$(t).attr("like-count",n),1==n?$(t).html(`<i class="fa fa-thumbs-up"></i>&nbsp;${n} Like`):$(t).html(`<i class="fa fa-thumbs-up"></i>&nbsp;${n} Likes`)})).fail((function(e){console.log("Error in toggle likes ajax request",e)}))}))}}class PostComments{constructor(e){this.postId=e,this.postContainer=$("#post-"+e),this.newCommentForm=$(`#post-${e}-comments-form`),this.createComment(e);let t=this;$(" .delete-comment-button",this.postContainer).each((function(){t.deleteComment($(this))}))}createComment(e){let t=this;this.newCommentForm.submit((function(n){n.preventDefault();$.ajax({type:"post",url:"/comments/create",data:$(this).serialize(),success:function(o){let s=t.newCommentDom(o.data.comment);console.log("nc",$("#post-comments-"+e)),$(s).insertBefore($(`#post-comment-container-${e}>.comment-form`)),t.deleteComment($(".delete-comment-button",s)),console.log(n.target.children[0],"72"),n.target.children[0].value="",new ToggleLikes($(" .toggle-like-button",s)),new Noty({theme:"relax",text:"Comment Published!",type:"success",layout:"topRight",timeout:1500}).show()},error:function(e){console.log(e.responseText)}})}))}newCommentDom(e){return e.user.avatar?$(`\n    <div class="social-comment" id="comment-${e._id}">\n  <a href="/users/profile/${e.user._id}" class="pull-left">\n    <img alt="image" src="${e.user.avatar}" />\n  </a>\n  <div class="media-body">\n    <a href="/users/profile/${e.user._id}">\n      ${e.user.name}\n    </a>\n    ${e.content}\n    <br />\n    <a\n      class="toggle-like-button small"\n      like-count="0"\n      href="/likes/toggle/?id=${e._id}&type=Comment"\n      ><i class="fa fa-thumbs-up"></i> 0 Likes</a\n    >\n\n    <small class="text-muted"> -\n      <a\n        class="delete-comment-button"\n        href="/comments/destroy/${e._id}"\n        >Delete</a\n      >\n      </small>\n  </div>\n</div>\n    `):$(`\n    <div class="social-comment" id="comment-${e._id}">\n  <a href="/users/profile/${e.user._id}" class="pull-left">\n    <img alt="image" src="https://icon-library.com/images/no-profile-pic-icon/no-profile-pic-icon-11.jpg" />\n  </a>\n  <div class="media-body">\n    <a href="/users/profile/${e.user._id}">\n      ${e.user.name}\n    </a>\n    ${e.content}\n    <br />\n    <a\n      class="toggle-like-button small"\n      like-count="0"\n      href="/likes/toggle/?id=${e._id}&type=Comment"\n      ><i class="fa fa-thumbs-up"></i> 0 Likes</a\n    >\n\n    <small class="text-muted"> -\n      <a\n        class="delete-comment-button"\n        href="/comments/destroy/${e._id}"\n        >Delete</a\n      >\n      </small>\n  </div>\n</div>\n    `)}deleteComment(e){$(e).click(t=>{t.preventDefault(),$.ajax({type:"get",url:$(e).prop("href"),success:function(e){$("#comment-"+e.data.comment_id).remove()},error:function(e){console.log(e.responseText)}})})}}{let e=async()=>{let e=$("#new-post-form");e.submit((function(o){o.preventDefault(),$.ajax({type:"post",url:"/posts/create",data:e.serialize(),success:function(e){console.log(e);let o=t(e.data.post);n($(" .delete-post-button",o)),new Noty({theme:"relax",text:"Post published!",type:"success",layout:"topRight",timeout:1500}).show(),$("#posts-list-container").prepend(o),new PostComments(e.data.post._id),new ToggleLikes($(" .toggle-like-button",o)),$("#textarea-np").val("")},error:function(e){console.log(e.responseText)}})}))},t=function(e){let t=e.user.avatar?""+e.user.avatar:"https://icon-library.com/images/no-profile-pic-icon/no-profile-pic-icon-11.jpg";return $(`<div class="social-feed-box" id="post-${e._id}">\n    <div class="social-avatar">\n      \n      <a href="" class="pull-left">\n        <img alt="image" src="${t}" />\n      </a>\n    \n      \n  \n      <div class="media-body">\n        <a href="/users/profile/${e.user._id}">\n          ${e.user.name}\n        </a>\n        <small class="text-muted">Just Now</small>\n      </div>\n    </div>\n    <div class="social-body">\n      <p>\n        ${e.content}\n      </p>\n  \n      <div class="btn-group">\n        <button class="btn btn-white btn-xs">\n          <a\n            class="toggle-like-button"\n            href="/likes/toggle?id=${e._id}&type=Post"\n            like-count="0"\n          >\n            <i class="fa fa-thumbs-up"></i>\n            0 Likes\n          </a>\n          \n        </button>\n        \n        <button class="btn btn-white btn-xs">\n          <a class="delete-post-button" href="/posts/destroy/${e._id}"\n            ><i class="fa fa-trash"></i\n          ></a>\n        </button>\n        \n      </div>\n    </div>\n  \n    <div class="social-footer" id="post-comment-container-${e._id}">\n      \n      <div class="social-comment comment-form">\n        <div class="media-body">\n          <form\n            action="/comments/create"\n            method="POST"\n            id="post-${e._id}-comments-form"\n            class="comment-form"\n          >\n            <input\n              type="text"\n              class="form-control"\n              name="content"\n              placeholder="Write comment..."\n              required\n            />\n            <input type="hidden" name="post" value="${e._id}" />\n            <input type="submit" value="Comment" style="display: none;" />\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n    `)},n=function(e){e.click(t=>{t.preventDefault(),$.ajax({type:"get",url:$(e).prop("href"),success:function(e){$("#post-"+e.data.post_id).remove(),new Noty({theme:"relax",text:"Post Deleted",type:"success",layout:"topRight",timeout:1500}).show()},error:{function(e){console.log(e.responseText)}}})})},o=function(){console.log($("#posts-list-container>div")),$("#posts-list-container>div").each((function(){let e=$(this),t=$(" .delete-post-button",e);n(t);let o=e.prop("id").split("-")[1];new PostComments(o),new ToggleLikes($(" .toggle-like-button",e))}))};e(),o()}